{#
tag picture per immagini

{%- include '@includes/imgs.html.twig' with {
  basename: 'xxxxx',
  alt: 'xxxx',
  class: 'img-fluid',
  lazyload: true, // facoltativo, default true
  base_url: glob_vars.img_base_url // facoltativo
  credits: 'html' // facoltativo

} -%}

l'include prevede che siano presenti tutti i breakpoints bootstrap
e che i nomi dei file abbiamo questa forma:

__basename__-md@2x.jpg
__basename__-lg@1x.webp
ecc.

#}
{% set base_url = base_url is defined ? base_url : glob_vars.img_base_url %} {# base url delle immagini #}
{% set alt = alt is defined ? alt : '' %}
{% set class = class is defined ? class : '' %}
{% set lazyload = lazyload is defined ? lazyload : true %}

{%- if lazyload and not('lazyload' in class) -%}
	{% set class = class ~ ' lazyload' %}
{%- endif -%}

<picture {%- if credits is defined %} class="has-credits"{%- endif -%}>
  {%- for breakpoint, mediaquery in glob_vars.mq|reverse -%}

  	{%- for formato in ['webp', 'jpg'] -%}
  		{% set srcset = [] %}

  		{% for densita in 1..3 if not (breakpoint in ['xl','lg'] and densita == 3 ) %}
  		  {% set srcset = srcset|merge([
    		  base_url ~ basename ~ '-' ~ breakpoint ~ '@' ~ densita ~ 'x.' ~ formato ~
    		  '?v=' ~ glob_vars.v ~ (densita > 1? ' ' ~ densita ~ 'x' : '')
    		]) %}
  		{%- endfor -%}

      {%- if breakpoint == 'xs' and formato == 'jpg' -%}

        <img {{ lazyload? 'data-' : '' -}} src="{{ srcset[0] }}"
          {{- lazyload? ' data-' : '' -}} srcset="{{ srcset|slice(1)|join(', ') }}" alt="{{ alt }}"
          {%- if class %} class="{{ class }}"{% endif %}>

      {%- else -%}

        <source {{ lazyload? 'data-' : '' -}} srcset="{{ srcset|join(', ') }}"
          {%- if formato == 'webp' %} type="image/webp"{% endif -%}
          {{- ' ' -}} media="{{ mediaquery }}">

      {%- endif -%}

  	{%- endfor -%}

  {%- endfor -%}
  {%- if credits is defined -%}
  	<div class="img_credits">{{ credits|raw }}</div>
  {%- endif -%}
</picture>
